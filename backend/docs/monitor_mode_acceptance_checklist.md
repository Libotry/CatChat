# 监控模式手工验收清单

> 目标：验证 `cat_chat.html` 的 **🛰️ 监控模式** 与后端 REST/WS 协议一致，关键事件链路稳定。

## 0. 前置条件

- 后端服务已启动：`python run.py`
- 浏览器打开项目根目录 `cat_chat.html`
- 切换到 **🛰️ 监控模式**
- 后端地址填写：`http://127.0.0.1:8000`

## 1. 房间创建

- 操作：点击 **创建AI房间**，人数选择 11（或 8~12 任一）
- 期望：
  - 房间 ID 自动回填
  - 全局状态显示“房间已创建”
  - 视角下拉含 `god` 与 `player:cat_xx`

## 2. WS 连接与订阅

- 操作：点击 **连接WS**
- 期望：
  - 出现连接成功提示
  - 收到并处理 `subscribed`
  - 收到并渲染 `room_state`

## 3. 视角切换

- 操作：视角切换为任意 `player:cat_xx`
- 期望：
  - 收到 `view_changed`
  - 随后收到新的 `room_state`
  - 玩家视角下不应出现 `game_metadata`、`god_view`

## 4. 游戏推进

- 操作：点击 **开始游戏**，再点击 **推进阶段**
- 期望：
  - 阶段日志新增记录（来自 `phase_changed`）
  - 全局状态中的 `phase/round` 更新（来自 `room_state`）
  - 若为夜晚狼人阶段，`god` 视角可看到 `god_view`

## 5. 配置与健康矩阵

- 操作：点击 **配置快照**、**Agent状态**
- 期望：
  - 配置快照展示 `player_count/role_distribution/night_order/warnings`
  - 健康矩阵显示在线状态、失败次数、错误信息（若有）

## 6. 发言时间轴

- 操作：推进到白天讨论/投票阶段并观察
- 期望：
  - `room_state.speech_history` 持续更新
  - 时间轴按最新在前展示，包含 `phase/player/content/is_fallback`

## 7. 断线与恢复

- 操作：刷新页面或手动断开 WS 后重连
- 期望：
  - 全局状态提示断开/重连
  - 重连后可继续收到 `room_state` 与后续事件

## 8. 最小回归结论模板

- 房间创建：通过 / 失败
- 订阅与事件流：通过 / 失败
- 视角隔离：通过 / 失败
- 阶段推进：通过 / 失败
- 配置与健康展示：通过 / 失败
- 发言时间轴：通过 / 失败
- 结论：可发布 / 需修复后复验
